# 设计文档

## 1. 功能设计

### 1.1. 用户管理功能

用户根据不同权限分为管理员和普通用户，相关功能设计如下：

- 用户注册
  - 默认分配 300 金币
  - 生成随机 Github 风格头像
- 用户登录
  - 可上传、更新头像
  - 查看自己的中奖记录
  - 查看 24 小时内所有用户中奖记录
- 用户权限
  - 管理员（admin / 123456）
    - 奖品管理
    - 设置奖品中奖概率
    - 查看用户列表
    - 查看中奖记录列表
  - 普通用户
    - 抽奖

### 1.2. 奖品管理功能

管理员拥有奖品管理权限：

- 添加奖品
- 设置奖品图片
- 设置奖品中奖概率
- 设置奖池中的奖品内容及排列顺序

### 1.3. 抽奖功能

核心抽奖玩法功能设计：

- 抽奖算法
  根据奖品中奖概率计算出对应的离散值，并根据随机数得到中奖结果

- 约束奖池中奖品概率和为 1
  不为 1 则抽奖结果不做统计

- 统计用户及中奖结果数据

### 1.4. 消息推送

使用 Socket.io 实现消息推送：

- 用户上线消息推送
- 用户中奖消息推送

### 1.5. 特色功能

为增加「来抽奖吧」系统的趣味性，增加如下功能：

- 用户上线及中奖通知使用弹幕形式展示
- 奖品类型分为三类：
  均扣除 100 金币，少于 100 金币无法抽奖

  - 文字
    扣除 100 金币，不统计此中奖结果
  - 金币
    金币数值可设置为正、负数，正数则为用户自动增加对应的金币数值，负数则继续减少用户对应的金币数值
  - 实物

- 签到功能
  每天可签到 1 次，增加 100 金币（暂未实现）

## 2. 界面设计

- 注册界面
- 登录界面
- 抽奖界面
  - 转奖盘
  - 用户当前金币数量
  - 24 小时内中奖记录
  - 推送消息弹幕
- 个人设置界面
  - 更新头像
  - 查看个人中奖记录
- 管理界面
  - 奖品管理
    - 奖池设置
    - 奖品列表
  - 用户管理
  - 获奖记录
- 404 界面

## 3. 权限及路由设计

- 管理员拥有所有功能权限。
  `/admin/*` 为后台管理界面路由

- 普通用户只能查看抽奖页面。

- 用户未登录时只能访问登录、注册界面。

- 用户访问不存在的路由，跳转 404 界面。

- 用户登录后，接口返回用户信息，判断是否为管理员用户。如果为管理员用户，则通过 `router.addRoute` 动态加载管理界面相关路由。
